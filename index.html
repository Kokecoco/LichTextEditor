<!DOCTYPE html>
<html lang="ja">
<head>
    
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@materializecss/materialize@2.0.3-alpha/dist/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/@materializecss/materialize@2.0.3-alpha/dist/js/materialize.min.js"></script>
            
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G6MX5YV63S"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-G6MX5YV63S');

      const analytics = () => {
          gtag('event', 'capture', {
          'event_category': 'button',
          'event_label': 'capture',
          'value': 1
        });
      }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>縦書きエディタ</title>
    <style>
        /* マテリアルデザインの色 */
:root {
  --md-primary-color: #2196F3;
  --md-secondary-color: #FFC107;
}

/* エディターのコンテナ */
.ck-editor__editable {
  padding: 16px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-family: 'Roboto', sans-serif;
  font-size: 16px;
}

/* ツールバーコンテナ */
.ck.ck-toolbar {
  background-color: var(--md-primary-color);
}

/* ツールバーアイテム */
.ck.ck-toolbar .ck-button {
  color: black;
}

/* ツールバーボタン */
.ck.ck-toolbar .ck-button:hover {
  background-color: var(--md-secondary-color);
}

/* ツールチップ */
.ck.ck-tooltip {
  background-color: var(--md-primary-color);
  color: white;
}

/* ツールチップのアイテム */
.ck.ck-tooltip .ck-tooltip__text {
  color: white;
}

/* リンク */
.ck.ck-content .ck-link {
  color: var(--md-secondary-color);
  text-decoration: underline;
}

/* リンク：hover */
.ck.ck-content .ck-link:hover {
  color: var(--md-primary-color);
}

/* 強調テキスト */
.ck.ck-content .ck-highlight {
  background-color: var(--md-secondary-color);
  color: white;
}

        
        /* エディタコンテナ全体のスタイル */
        .ck-editor__editable_inline {
            writing-mode: vertical-rl;
            height: 600px; /* 必要に応じて高さを調整 */
            overflow: auto; /* オーバーフロー対策 */
            border: 1px solid #ccc; /* 視覚的に区切るためのボーダー */
            box-sizing: border-box; /* ボーダーのサイズも幅に含める */
            padding: 16px; /* 編集エリアの内側に余白を追加 */
        }

        /* ツールバーとエディタの幅を一致させるためのスタイル */
        .ck-editor__main {
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }

        .ck-editor__editable {
            width: 100%;
            box-sizing: border-box; /* ボーダーのサイズも幅に含める */
        }

        /* テキストの上下に余白を追加 */
        .ck-editor__editable p {
            margin-top: 28.8px; /* 上部の余白 */
            margin-bottom: 28.8px; /* 下部の余白 */
            margin-right: 5px; /* 右側の余白 */
            margin-left: 5px; /* 左側の余白 */
        }

        .ck-editor__editable h1 {
            margin-top: 28.8px; /* 上部の余白 */
            margin-bottom: 28.8px; /* 下部の余白 */
            margin-right: 16px; /* 右側の余白 */
            margin-left: 16px; /* 左側の余白 */
        }

        .ck-editor__editable h2 {
            margin-top: 28.8px; /* 上部の余白 */
            margin-bottom: 28.8px; /* 下部の余白 */
            margin-right: 16px; /* 右側の余白 */
            margin-left: 16px; /* 左側の余白 */
        }

        .ck-editor__editable h3 {
            margin-top: 28.8px; /* 上部の余白 */
            margin-bottom: 28.8px; /* 下部の余白 */
            margin-right: 16px; /* 右側の余白 */
            margin-left: 16px; /* 左側の余白 */
        }
    </style>
</head>
<body>
    <h1>縦書きエディタ</h1>
    <div id="editor"></div>
    <button id="capture" class="btn filled blue waves-effect waves-light" onclick="analytics()">キャプチャして保存</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <script src="ckeditor5/build/ckeditor.js"></script>
    <script>
        ClassicEditor
            .create(document.querySelector('#editor'))
            .then(editor => {
                const toolbarContainer = editor.ui.view.toolbar.element.parentElement;
                const editableElement = editor.ui.view.editable.element;
                
                // ツールバーとエディタの幅を一致させる
                const resizeEditor = () => {
                    const toolbarWidth = toolbarContainer.offsetWidth;
                    editableElement.style.width = `${toolbarWidth}px`;
                };

                // 初期リサイズ
                resizeEditor();

                // ウィンドウリサイズ時に再調整
                window.addEventListener('resize', resizeEditor);

                // ツールバーの変化を監視して幅を調整
                new ResizeObserver(resizeEditor).observe(toolbarContainer);

                document.getElementById('capture').addEventListener('click', () => {
                    // キャプチャ対象要素
                    const editorElement = editor.ui.view.editable.element;

                    // dom-to-imageでキャプチャ
                    domtoimage.toBlob(editorElement)
                        .then(blob => {
                            // 画像として保存
                            const link = document.createElement('a');
                            link.href = URL.createObjectURL(blob);
                            link.download = 'editor-content.png';
                            link.click();
                        })
                        .catch(error => {
                            console.error('キャプチャエラー:', error);
                        });
                });
            })
            .catch(error => {
                console.error(error);
            });
    </script>
</body>
</html>
