<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>縦書きエディタ</title>
    <style>
        /* エディタコンテナ全体のスタイル */
        .ck-editor__editable_inline {
            writing-mode: vertical-rl;
            height: 600px; /* 必要に応じて高さを調整 */
            overflow: auto; /* オーバーフロー対策 */
            border: 1px solid #ccc; /* 視覚的に区切るためのボーダー */
            box-sizing: border-box; /* ボーダーのサイズも幅に含める */
            padding: 16px; /* 編集エリアの内側に余白を追加 */
        }

        /* ツールバーとエディタの幅を一致させるためのスタイル */
        .ck-editor__main {
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }

        .ck-editor__editable {
            width: 100%;
            box-sizing: border-box; /* ボーダーのサイズも幅に含める */
        }

        /* テキストの上下に余白を追加 */
        .ck-editor__editable p {
            margin-top: 28.8px; /* 上部の余白 */
            margin-bottom: 28.8px; /* 下部の余白 */
            margin-right: 5px; /* 右側の余白 */
            margin-left: 5px; /* 左側の余白 */
        }

        .ck-editor__editable h1 {
            margin-top: 28.8px; /* 上部の余白 */
            margin-bottom: 28.8px; /* 下部の余白 */
            margin-right: 16px; /* 右側の余白 */
            margin-left: 16px; /* 左側の余白 */
        }

        .ck-editor__editable h2 {
            margin-top: 28.8px; /* 上部の余白 */
            margin-bottom: 28.8px; /* 下部の余白 */
            margin-right: 16px; /* 右側の余白 */
            margin-left: 16px; /* 左側の余白 */
        }

        .ck-editor__editable h3 {
            margin-top: 28.8px; /* 上部の余白 */
            margin-bottom: 28.8px; /* 下部の余白 */
            margin-right: 16px; /* 右側の余白 */
            margin-left: 16px; /* 左側の余白 */
        }
    </style>
</head>
<body>
    <h1>縦書きエディタ</h1>
    <div id="editor"></div>
    <button id="capture">キャプチャして保存</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <script src="ckeditor5/build/ckeditor.js"></script>
    <script>
        ClassicEditor
            .create(document.querySelector('#editor'))
            .then(editor => {
                const toolbarContainer = editor.ui.view.toolbar.element.parentElement;
                const editableElement = editor.ui.view.editable.element;
                
                // ツールバーとエディタの幅を一致させる
                const resizeEditor = () => {
                    const toolbarWidth = toolbarContainer.offsetWidth;
                    editableElement.style.width = `${toolbarWidth}px`;
                };

                // 初期リサイズ
                resizeEditor();

                // ウィンドウリサイズ時に再調整
                window.addEventListener('resize', resizeEditor);

                // ツールバーの変化を監視して幅を調整
                new ResizeObserver(resizeEditor).observe(toolbarContainer);

                document.getElementById('capture').addEventListener('click', () => {
                    // キャプチャ対象要素
                    const editorElement = editor.ui.view.editable.element;

                    // dom-to-imageでキャプチャ
                    domtoimage.toBlob(editorElement)
                        .then(blob => {
                            // 画像として保存
                            const link = document.createElement('a');
                            link.href = URL.createObjectURL(blob);
                            link.download = 'editor-content.png';
                            link.click();
                        })
                        .catch(error => {
                            console.error('キャプチャエラー:', error);
                        });
                });
            })
            .catch(error => {
                console.error(error);
            });
    </script>
</body>
</html>
